    <transition name="fade" mode="out-in" v-cloak>
        <div v-if="currentTab === 'jm_categories'" class="space-y-6 pb-20">
            <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                    <h2 class="text-2xl md:text-3xl font-bold flex items-center gap-3">
                        <span class="material-symbols-rounded text-primary">category</span>
                        JM 分类
                    </h2>
                    <p class="text-sm opacity-60 mt-1">选择分类后浏览/搜索</p>
                </div>
                <div class="flex items-center gap-2">
                    <button @click="loadJmCategories" :disabled="jmCategoriesLoading"
                        class="w-10 h-10 rounded-full bg-surface-variant text-on-surface-variant flex items-center justify-center hover:bg-primary hover:text-on-primary transition disabled:opacity-40">
                        <span class="material-symbols-rounded" :class="jmCategoriesLoading ? 'animate-spin' : ''">refresh</span>
                    </button>
                    <button @click="currentTab = 'home'"
                        class="w-10 h-10 rounded-full bg-surface-variant text-on-surface-variant flex items-center justify-center hover:bg-primary hover:text-on-primary transition">
                        <span class="material-symbols-rounded">arrow_back</span>
                    </button>
                </div>
            </div>

            <div class="md-card p-4 md:p-6 border border-outline/10 space-y-4">
                <div class="flex flex-col md:flex-row md:items-center gap-3">
                    <div class="flex-1 md-input-container flex items-center px-4 h-12">
                        <span class="material-symbols-rounded text-primary mr-3">search</span>
                        <input v-model="jmCategoryKeyword" class="md-input w-full text-sm" placeholder="在选中分类内搜索关键词（可选）">
                    </div>
                    <button @click="jmSearchInCategory" :disabled="!jmSelectedCategory || !jmCategoryKeyword.trim()"
                        class="md-btn-primary h-12 px-6 disabled:opacity-40 disabled:cursor-not-allowed">
                        <span class="material-symbols-rounded">travel_explore</span>
                        搜索
                    </button>
                </div>

                <div class="text-sm opacity-70">
                    当前分类：
                    <span class="font-bold text-primary">{{ jmSelectedCategoryTitle || '未选择' }}</span>
                </div>

                <div class="text-xs opacity-60 flex flex-wrap gap-x-4 gap-y-1">
                    <div>slug：<span class="font-bold">{{ jmSelectedCategory || '0' }}</span></div>
                    <div class="truncate max-w-full">API：<span class="font-bold">{{ jmDebugLastOkApiBase || jmDebugApiBase || '-' }}</span></div>
                </div>

                <div v-if="jmCategoriesLoading" class="flex items-center justify-center py-10 opacity-60">
                    <span class="material-symbols-rounded text-4xl animate-spin text-primary">progress_activity</span>
                </div>

                <div v-else-if="jmCategoriesError" class="p-4 rounded-2xl bg-surface border border-outline/10">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-rounded text-error">error</span>
                        <div class="min-w-0 flex-1">
                            <div class="font-bold">分类加载失败</div>
                            <div class="text-sm opacity-70 break-words mt-1">{{ jmCategoriesError }}</div>
                        </div>
                        <button @click="loadJmCategories" class="h-10 px-4 rounded-full bg-surface-variant border border-outline/10 text-on-surface-variant hover:bg-primary hover:text-on-primary transition font-bold">
                            重试
                        </button>
                    </div>
                </div>

                <div v-else class="flex gap-2 overflow-x-auto max-w-full pb-2 no-scrollbar">
                    <button v-for="c in jmCategories" :key="String(c.CID || c.id || c.name || c.title || c)"
                        @click="selectJmCategory(c)"
                        class="h-10 px-4 rounded-full border text-sm font-medium transition whitespace-nowrap"
                        :class="jmSelectedCategory === getJmCategoryId(c) ? 'bg-primary text-on-primary border-transparent shadow-md' : 'bg-surface text-on-surface border-outline/20 hover:bg-primary/10'">
                        {{ getJmCategoryTitle(c) }}
                    </button>
                </div>

            </div>

            <loading-state :loading="jmCategoryLoading && jmCategoryItems.length === 0">
                <span class="mt-2 text-sm text-on-surface-variant">正在加载分类内容...</span>
            </loading-state>

            <error-state :error="jmCategoryError" @retry="loadJmCategoryList(jmSelectedCategory, 1)"></error-state>

            <div v-if="jmCategoryItems.length > 0" class="md-card p-4 md:p-6 border border-outline/10 space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold flex items-center gap-3">
                        <span class="material-symbols-rounded text-primary">view_list</span>
                        分类内容
                    </h3>
                    <div class="flex items-center gap-2">
                        <button @click="loadJmCategoryList(jmSelectedCategory, 1)" :disabled="jmCategoryLoading || !jmSelectedCategory"
                            class="h-10 px-4 rounded-full bg-surface-variant border border-outline/10 text-on-surface-variant hover:bg-primary hover:text-on-primary transition text-sm font-medium disabled:opacity-40 disabled:cursor-not-allowed">
                            刷新列表
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-4">
                    <book-card 
                        v-for="book in jmCategoryItems" 
                        :key="book.album_id" 
                        :book="book" 
                        @click="viewDetails">
                    </book-card>
                </div>

                <loading-state :loading="jmCategoryLoading">
                     <span class="mt-2 text-sm">正在加载分页...</span>
                </loading-state>

                <pagination-controls 
                    v-if="!jmCategoryLoading"
                    :page="jmCategoryPage" 
                    :loading="jmCategoryLoading" 
                    :has-more="true"
                    @prev="loadJmCategoryList(jmSelectedCategory, jmCategoryPage - 1)" 
                    @next="loadJmCategoryList(jmSelectedCategory, jmCategoryPage + 1)">
                </pagination-controls>
            </div>

            <div v-else-if="jmSelectedCategory && !jmCategoryLoading" class="md-card p-6 md:p-8 border border-outline/10 text-center opacity-70">
                <div class="font-bold text-on-surface-variant">该分类暂无内容</div>
                <div class="text-xs opacity-60 mt-2">可尝试切换分类或点击“刷新”</div>
            </div>
        </div>
    </transition>
